<script type="text/javascript">

jQuery(document).ready(function() {
    jQuery('#mycarousel').jcarousel();
});

</script>
<% @pagetitle = @document.name %>

<!-- Update document views in db -->
<% Document.increment_counter(:views, @document.id) %>


<!-- Show Individual Document page -->
<div class="introduction">
	<span class="headline4 lead">
		<% if @document.is_featured%>
			<%= image_tag("icons/star.gif",:height=>"16", :title=>"This is a featured item")%>
		<%end%>	
		<% if @document.name.blank? %>
			<%= @document.title %>
		<% else %>  
			<%= @document.name %>
		<% end %>
	</span>
	<br />
	
	<% if @document.is_on_sale? && !@document.sale_price.blank? && @document.sale_price > 0.50 %>
		<strong class="">This item is for sale</strong>
	<%else%>
		<strong >This item is not for sale</strong>
	<% end %>	

    <% if !current_user.blank? && (current_user.is_document_owner(@document.user_id) || current_user.is_admin) %>
    
    	<span class="pull-right"><%= link_to '<i class="icon-edit"></i> Edit Document'.html_safe, edit_document_path(@document),:class=>"btn btn-mini" %></span>
    <% end %>
</div>

<% %>
	<% if current_user %>
		<% payment_service_for @document.id, PAYPAL_ACCOUNT, :amount => @document.sale_price, :currency => 'GBP', :service => :paypal, :html => { :id => 'payment-form' } do |service| %>
        	<% service.customer :first_name => current_user.first_name, :last_name => current_user.last_name,:email => current_user.email %>
           	<% service.billing_address :city => current_user.city, :address1 => current_user.address1, :address2 => current_user.address2,:state => current_user.county,:zip => current_user.post_code %>
           	<% service.item_name  service.shipping '0.00' %>
           	<% service.tax '0.00' %>
           	<% service.notify_url paypal_ipn_url %>
           	<% service.return_url paypal_return_url %>
           	<% service.cancel_return_url paypal_cancel_url %> 
            <% submit_tag("Buy From Paypal".html_safe,:class=>"btn btn-warning") %>
		<% end %>
	<% end %>
<% %>	

<div class="document_details_container">

	<div class="document_attributes_container pull-left span3">
	
		<div class="document_detail">
      <b>Title:</b>  <%= @document.try(:title) %><br />
      <b>Type:</b>   <%= @document.document_type.try(:name) %><br />
    	<b>Status:</b> <%= @document.status.try(:name) %><br />
    	<b>Price:</b>  <%= number_to_currency(@document.try(:sale_price), :unit => " &pound;").html_safe unless @document.sale_price.blank? %>
		</div>
	
		<div class="document_detail">
			<% @document.attribute_documents.each do |doc_attr| %>
       	<%= doc_attr.attribute_type.try(:name) %>: <%= "#{doc_attr.value}" %><%= ", #{doc_attr.attribute_location}" unless doc_attr.attribute_location.blank? %><%= ", #{doc_attr.attribute_year}" unless doc_attr.attribute_year.blank? %><br />
      <% end %>
      <b>Tags</b>      
      <% @document.tags.each do |tag| %>
        <%= tag.name %> 
      <% end %>

		</div>
		<div class="document_detail">
           	<b>Dimensions</b><br />
           	<%= "#{@document.try(:length)}mm x " unless @document.length.blank? %> 
           	<%= "#{@document.try(:width)}mm x " unless @document.width.blank? %> 
           	<%= "#{@document.try(:depth)}mm" unless @document.depth.blank? %><br />
           	Weight: <%= "#{@document.try(:weight)}g" unless @document.weight.blank?%><br />
           	Added: <%= @document.created_at.strftime("%d/%m/%Y")%><br />
           	Price: <%= number_to_currency(@document.try(:sale_price), :unit => " &pound;").html_safe unless @document.sale_price.blank? %><br />
			<br />
			<b>Stock Number:</b> <%= @document.stock_number %><br />
			<b>Owner:</b> <%= @document.user.username %> (see owner's other items)<br />
 			<b>Views:</b> <%= @document.views+1 %>
 		</div>
	</div>	

	<div class="document_photos_container pull-right span7 offset1 jcarousel-skin-tango" >
		<% if !@document.blank? && !@document.document_photos.blank? %>
        	<div style="margin-left:20px">
        	  <%= image_tag @document.default_image.photo.url(:large) %>
        	</div>
        	<div class="scroller">
          <ul class="jcarousel-skin-tango" id="mycarousel">
            <% @document.document_photos.each do |photo|  %>
		          <li>
		            <a href="<%= photo.photo.url(:large) %>" class='' rel="lightbox">
		              <%= image_tag photo.photo.url(:small)%>
		            </a>
		          </li>
	        	<% end %>
          </ul>
          </div>
		<% end %>
	</div>

	<div class=" clearfix" style="content='';display:table;width:100%"><strong class="lead">Description: </strong>
		<h3><%= @document.try(:comment) %></h3>
		<br/>
	</div>

</div>

<% if !current_user %>
	<div class="document_heading">Please Register or Login to see full details about this item</div>
<% else %>
	<%= render "document_extended_details" %>
<% end %>
<!-- Container End -->
